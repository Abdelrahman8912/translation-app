# -*- coding: utf-8 -*-
"""Language_Translation_and_Grammar_Tool.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1yzaH1atJut-cM1gNqS45U-6YfHGcH7ka
"""

!pip install --upgrade pip
!pip install transformers gradio torch sentencepiece huggingface-hub --quiet

# Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Hugging Face
!pip install transformers sentencepiece torch -q

# Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø³ØªÙŠØ±Ø§Ø¯ pipeline
from transformers import pipeline

# Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
translator = pipeline("translation", model="Helsinki-NLP/opus-mt-ar-en")

# Ø§Ù„Ø®Ø·ÙˆØ© 4: ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø©
# text = "Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø£Ø²ÙˆØ± ØµØ¯ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"
# result = translator(text)[0]['translation_text']

!pip install transformers gradio torch sentencepiece --quiet

from transformers import pipeline, AutoTokenizer, AutoModelForSeq2SeqLM
import gradio as gr

# ğŸ”¹ Ø§Ù„Ù„ØºØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©
SUPPORTED_LANGS = {
    "English": "en",
    "Arabic": "ar",
    "French": "fr"
}

_translation_pipelines = {}
_grammar_pipelines = {}


# ğŸ”¹ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø©
def get_translation_pipeline(src, tgt):
    key = f"{src}-{tgt}"
    if key in _translation_pipelines:
        return _translation_pipelines[key]
    model_name = f"Helsinki-NLP/opus-mt-{src}-{tgt}"
    tokenizer = AutoTokenizer.from_pretrained(model_name)
    model = AutoModelForSeq2SeqLM.from_pretrained(model_name)
    pipe = pipeline("translation", model=model, tokenizer=tokenizer)
    _translation_pipelines[key] = pipe
    return pipe


# ğŸ”¹ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¯ÙŠÙ„ ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
def get_grammar_pipeline(lang):
    if lang in _grammar_pipelines:
        return _grammar_pipelines[lang]

    if lang == "Arabic":
        model_name = "qcri/arabic-roberta-base-sentence-correction"
        pipe = pipeline("text2text-generation", model=model_name, tokenizer=model_name)
    else:
        model_name = "prithivida/grammar_error_correcter_v1"
        pipe = pipeline("text2text-generation", model=model_name, tokenizer=model_name)

    _grammar_pipelines[lang] = pipe
    return pipe


# ğŸ”¹ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø©
def translate(text, src_lang, tgt_lang):
    if not text.strip():
        return "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ."
    if src_lang == tgt_lang:
        return text
    src = SUPPORTED_LANGS[src_lang]
    tgt = SUPPORTED_LANGS[tgt_lang]
    pipe = get_translation_pipeline(src, tgt)
    result = pipe(text)[0]['translation_text']
    return result


# ğŸ”¹ Ø¯Ø§Ù„Ø© ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ + Ø¹Ø±Ø¨ÙŠ)
def grammar_check(text, lang):
    if not text.strip():
        return "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ."
    pipe = get_grammar_pipeline(lang)
    result = pipe(text)[0]
    if "generated_text" in result:
        return result["generated_text"]
    elif "text" in result:
        return result["text"]
    return str(result)


# ğŸ”¹ ÙˆØ§Ø¬Ù‡Ø© Gradio
def launch_demo():
    with gr.Blocks() as demo:
        gr.Markdown("## ğŸŒ Language Translation & Grammar Correction Tool (Arabic + English)")

        text_input = gr.Textbox(lines=6, label="Enter your text:")
        src_lang = gr.Dropdown(list(SUPPORTED_LANGS.keys()), value="English", label="Source Language")
        tgt_lang = gr.Dropdown(list(SUPPORTED_LANGS.keys()), value="Arabic", label="Target Language")

        with gr.Row():
            translate_btn = gr.Button("Translate")
            grammar_btn = gr.Button("Grammar Check")
            clear_btn = gr.Button("Clear")

        output_box = gr.Textbox(lines=6, label="Output")

        translate_btn.click(translate, inputs=[text_input, src_lang, tgt_lang], outputs=output_box)
        grammar_btn.click(grammar_check, inputs=[text_input, src_lang], outputs=output_box)
        clear_btn.click(lambda: "", outputs=output_box)

    demo.launch(share=True)


# âœ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
launch_demo()

Running on public URL: https://xxxx.gradio.live

# Commented out IPython magic to ensure Python compatibility.
# %%writefile requirements.txt
# transformers
# torch
# sentencepiece
# gradio
# accelerate
# sacremoses
#

from google.colab import files
files.download("requirements.txt")